{% load static %}

<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script
      src="https://kit.fontawesome.com/743993a713.js"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/3.0.3/dexie.min.js"></script>
    <script>
        // Initialize IndexedDB database using Dexie.js
        const db = new Dexie('BucketApp');
        db.version(1).stores({
            buckets: '++id,title,description,owner_id',
            tasks: '++id,title,description,created,updated,bucket_id,assignee_id,complete',
        });
    
        // Function to fetch data from Django API and store it in IndexedDB
        async function fetchDataAndStoreInIndexedDB() {
            const response = await fetch('/api/buckets/'); // Change the URL according to your Django API views
            const data = await response.json();
    
            // Store buckets in IndexedDB
            await db.buckets.bulkPut(data.buckets);
    
            // Store tasks in IndexedDB
            await db.tasks.bulkPut(data.tasks);
        }
    
        // Call the function to fetch data and store in IndexedDB when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchDataAndStoreInIndexedDB();
        });
    </script>

    <title>Django Bucket App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div style="max-width: 768px; margin: 0 auto;">
      <header class="site-header">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" id="navId" role="tablist">
          <li class="nav-item">
            <a href="{% url 'bucket-list' %}" class="nav-link" aria-current="page"
              >Home</a
            >
          </li>

          {% if user.is_authenticated %}
            <li class="nav-item" role="presentation">
              <a href="#" class="nav-link text-muted text-decoration-none">{{ user }}</a>
            </li>
            <li class="nav-item" role="presentation">
              <a href="{% url 'logout' %}" class="nav-link">Logout</a>
            </li>
          
          {% else %}
            <li class="nav-item" role="presentation">
              <a href="{% url 'signup' %}" class="nav-link">Signup</a>
            </li>
            <li class="nav-item" role="presentation">
              <a href="{% url 'login' %}" class="nav-link">Login</a>
            </li>
          {% endif %}
        </ul>
      </header>

      {% if messages %}
        <div class="container mt-3">
            {% for message in messages %}
                <div{% if message.tags %} class="{{ message.tags }}"{% endif %} role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              </div>
            {% endfor %}
        </div>
      {% endif %}
      
      <div role="main" class="container-fluid">
        {% block content %}{% endblock %}
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
